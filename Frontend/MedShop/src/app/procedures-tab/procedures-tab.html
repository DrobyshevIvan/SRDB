<section class="panel">
    <header>
      <h3>usp_PurchaseProduct</h3>
    </header>
    <form class="form-grid" autocomplete="off">
      <label>
        <span>ProductId</span>
        <input
          type="number"
          placeholder="Наприклад, 1"
          [value]="procedureFormState().productId"
          (input)="onProcedureFieldChange('productId', $any($event.target).value)"
        />
      </label>
      <label>
        <span>UserId</span>
        <input
          type="number"
          placeholder="Наприклад, 3"
          [value]="procedureFormState().userId"
          (input)="onProcedureFieldChange('userId', $any($event.target).value)"
        />
      </label>
      <label>
        <span>Quantity</span>
        <input
          type="number"
          min="1"
          [value]="procedureFormState().quantity"
          (input)="onProcedureFieldChange('quantity', $any($event.target).valueAsNumber || 1)"
        />
      </label>
      <label>
        <span>OrderId (опційно)</span>
        <input
          type="number"
          placeholder="NULL"
          [value]="procedureFormState().orderId"
          (input)="onProcedureFieldChange('orderId', $any($event.target).value)"
        />
      </label>
    </form>
    <button
      class="primary"
      type="button"
      [disabled]="procedurePending()"
      (click)="executeProcedure()"
    >
      @if (procedurePending()) {
        Обробка...
      } @else {
        Виконати процедуру
      }
    </button>
    @if (procedureMessage(); as message) {
      <div class="notice" [class.notice-error]="message.type === 'error'">
        {{ message.text }}
      </div>
    }
    
    <div class="orders-feed">
      <h4>Останні замовлення</h4>
      @if (ordersLoading()) {
        <div class="empty-state">
          <p>Завантажуємо замовлення...</p>
        </div>
      } @else if (ordersError(); as error) {
        <div class="empty-state">
          <p>{{ error }}</p>
          <button class="primary ghost" type="button" (click)="refreshOrders()">
            Оновити
          </button>
        </div>
      } @else if (orders().length === 0) {
        <div class="empty-state">
          <p>Замовлень ще не створювали.</p>
        </div>
      } @else {
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Користувач</th>
              <th>Дата</th>
              <th>Сума</th>
              <th>Статус</th>
            </tr>
          </thead>
          <tbody>
            @for (order of orders(); track order.id) {
              <tr>
                <td>{{ order.id }}</td>
                <td>{{ order.user.fullName || order.user.userName }}</td>
                <td>{{ order.orderDate | date: 'dd.MM.yyyy' }}</td>
                <td>{{ order.totalAmount | number:'1.2-2' }} ₴</td>
                <td>{{ order.status }}</td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </section>